<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Box 73 - Painel da Oficina</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîß</text></svg>">
</head>
<body>
<div id="app">
    <section class="screen active" id="oficina-panel">
        <div class="container">
            <div class="brand-container">
                <h1 class="brand-title">Box 73</h1>
                <p class="brand-subtitle">üîß Painel da Oficina</p>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-tab="tab-dashboard">üìä Dashboard</button>
                <button class="tab" data-tab="tab-cadastro">üë§ Embaixador</button>
                <button class="tab" data-tab="tab-mecanicas">‚öôÔ∏è Mec√¢nicas</button>
                <button class="tab" data-tab="tab-criar-cupom">üé´ Criar Cupom</button>
                <button class="tab" data-tab="tab-validar">‚úÖ Validar</button>
            </div>

            <!-- ===== TAB: DASHBOARD ===== -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-icon">üë•</div><div class="stat-content"><div class="stat-value" id="st-emb">0</div><div class="stat-label">Embaixadores</div></div></div>
                    <div class="stat-card"><div class="stat-icon">üé´</div><div class="stat-content"><div class="stat-value" id="st-cup">0</div><div class="stat-label">Cupons Ativos</div></div></div>
                    <div class="stat-card accent-card"><div class="stat-icon">‚úÖ</div><div class="stat-content"><div class="stat-value" id="st-val">0</div><div class="stat-label">Valida√ß√µes</div></div></div>
                    <div class="stat-card"><div class="stat-icon">‚öôÔ∏è</div><div class="stat-content"><div class="stat-value" id="st-mec">0</div><div class="stat-label">Mec√¢nicas</div></div></div>
                </div>

                <h2 class="section-subtitle">Embaixadores Cadastrados</h2>
                <div id="ambassadors-list" class="card-list"></div>

                <h2 class="section-subtitle" style="margin-top:var(--spacing-2xl)">√öltimas Valida√ß√µes</h2>
                <div id="recent-validations" class="card-list"></div>
            </div>

            <!-- ===== DETALHE DO EMBAIXADOR (sobrep√µe dashboard) ===== -->
            <div id="tab-detalhe-embaixador" class="tab-content">
                <button class="btn-back" id="back-from-detalhe">‚Üê Voltar ao Dashboard</button>
                <div class="detail-header">
                    <h2 class="section-title" id="det-nome">---</h2>
                    <p id="det-info" class="detail-subinfo">CPF: --- ¬∑ Tel: ---</p>
                </div>
                <h3 class="section-subtitle">Cupons deste Embaixador</h3>
                <div id="det-cupons" class="card-list"></div>
                <h3 class="section-subtitle" style="margin-top:var(--spacing-xl)">Valida√ß√µes</h3>
                <div id="det-validacoes" class="card-list"></div>
            </div>

            <!-- ===== TAB: CADASTRAR EMBAIXADOR ===== -->
            <div id="tab-cadastro" class="tab-content">
                <div class="form-card">
                    <h2 class="section-subtitle">Cadastrar Novo Embaixador</h2>
                    <p class="form-description">Preencha os dados do cliente que ser√° embaixador.</p>
                    <div class="input-group"><label>Nome Completo *</label><input type="text" id="reg-nome" placeholder="Ex: Jo√£o da Silva" class="input-field"></div>
                    <div class="input-group"><label>CPF *</label><input type="text" id="reg-cpf" placeholder="000.000.000-00" class="input-field" maxlength="14"></div>
                    <div class="input-group"><label>Celular / WhatsApp *</label><input type="tel" id="reg-tel" placeholder="(00) 00000-0000" class="input-field" maxlength="15"></div>
                    <button class="btn btn-primary btn-large" id="btn-cadastrar-emb">Cadastrar Embaixador</button>
                </div>
            </div>

            <!-- ===== TAB: MEC√ÇNICAS ===== -->
            <div id="tab-mecanicas" class="tab-content">
                <div class="form-card">
                    <h2 class="section-subtitle">Criar Mec√¢nica de Cupom</h2>
                    <p class="form-description">Defina as regras, benef√≠cios e limites de uma campanha de cupons.</p>
                    <div class="input-group"><label>Nome da Mec√¢nica *</label><input type="text" id="mec-nome" placeholder="Ex: Promo√ß√£o Revis√£o 2026" class="input-field"></div>
                    <div class="input-group"><label>Descri√ß√£o</label><textarea id="mec-descricao" placeholder="Descreva a mec√¢nica..." class="input-field" rows="2"></textarea></div>
                    <div class="input-group"><label>Benef√≠cio para o Dono do Cupom (Embaixador) *</label><input type="text" id="mec-benef-emb" placeholder="Ex: 15% de desconto na pr√≥xima revis√£o" class="input-field"></div>
                    <div class="input-group"><label>Quantas valida√ß√µes o embaixador precisa para ganhar o benef√≠cio *</label><input type="number" id="mec-meta" placeholder="Ex: 3" class="input-field" min="1" value="3"></div>
                    <div class="input-group"><label>Benef√≠cio para o Cliente que usa o cupom *</label><input type="text" id="mec-benef-cli" placeholder="Ex: 10% de desconto na primeira revis√£o" class="input-field"></div>
                    <div class="input-group"><label>Limite de cupons que podem ser emitidos *</label><input type="number" id="mec-limite" placeholder="Ex: 100" class="input-field" min="1" value="100"></div>
                    <div class="form-row">
                        <div class="input-group"><label>Data In√≠cio *</label><input type="date" id="mec-inicio" class="input-field"></div>
                        <div class="input-group"><label>Data Fim *</label><input type="date" id="mec-fim" class="input-field"></div>
                    </div>
                    <button class="btn btn-primary btn-large" id="btn-criar-mecanica">Criar Mec√¢nica</button>
                </div>

                <h2 class="section-subtitle" style="margin-top:var(--spacing-2xl)">Mec√¢nicas Cadastradas</h2>
                <div id="mecanicas-list" class="card-list"></div>
            </div>

            <!-- ===== TAB: CRIAR CUPOM ===== -->
            <div id="tab-criar-cupom" class="tab-content">
                <div class="form-card">
                    <h2 class="section-subtitle">Criar Cupom para Embaixador</h2>
                    <p class="form-description">Vincule um c√≥digo de cupom a um embaixador e a uma mec√¢nica v√°lida.</p>
                    <div class="input-group"><label>CPF do Embaixador *</label><input type="text" id="cup-cpf" placeholder="000.000.000-00" class="input-field" maxlength="14"></div>
                    <div id="cup-emb-info" class="info-box" style="display:none"></div>
                    <div class="input-group"><label>Mec√¢nica do Cupom *</label><select id="cup-mecanica" class="input-field"><option value="">Selecione uma mec√¢nica...</option></select></div>
                    <div id="cup-mec-info" class="info-box" style="display:none"></div>
                    <div class="input-group">
                        <label>C√≥digo do Cupom *</label>
                        <div class="input-with-action">
                            <input type="text" id="cup-codigo" placeholder="Ex: JOAO73" class="input-field" style="text-transform:uppercase">
                            <button class="btn btn-secondary btn-sm" id="btn-gerar-codigo">Gerar Auto</button>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-large" id="btn-criar-cupom">Criar Cupom</button>
                </div>
            </div>

            <!-- ===== TAB: VALIDAR CUPOM ===== -->
            <div id="tab-validar" class="tab-content">
                <div class="form-card">
                    <h2 class="section-subtitle">Validar Cupom</h2>
                    <p class="form-description">Digite o c√≥digo do cupom apresentado pelo cliente.</p>
                    <div class="search-box">
                        <input type="text" id="search-coupon" placeholder="C√≥digo do cupom..." class="search-input">
                        <button class="btn btn-primary" id="btn-validate">Validar</button>
                    </div>
                    <div id="validation-result" style="display:none"></div>
                    <div id="use-coupon-form" class="use-form" style="display:none">
                        <h3 class="section-subtitle">Registrar Uso</h3>
                        <div class="input-group"><label>Nome do Cliente Indicado *</label><input type="text" id="indicado-name" placeholder="Nome completo" class="input-field"></div>
                        <div class="input-group"><label>Telefone do Indicado</label><input type="tel" id="indicado-phone" placeholder="(00) 00000-0000" class="input-field"></div>
                        <div class="input-group"><label>Servi√ßo Realizado</label><textarea id="observations" placeholder="Ex: Revis√£o completa..." class="input-field" rows="2"></textarea></div>
                        <button class="btn btn-primary btn-large" id="btn-mark-used">‚úÖ Confirmar Uso</button>
                    </div>
                </div>
            </div>

            <!-- Link do cliente -->
            <div class="client-link-banner">
                <p>üì± Link para clientes consultarem seus cupons:</p>
                <div class="link-display">
                    <span id="client-link-url"></span>
                    <button class="btn btn-secondary btn-sm" id="btn-copy-link">Copiar</button>
                </div>
            </div>
        </div>
    </section>
</div>

<div id="toast" class="toast"></div>
<div id="loading-overlay" class="loading-overlay" style="display:none"><div class="spinner"></div></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script>
<script src="app.js"></script>
</body>
</html>
